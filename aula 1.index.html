<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Sistema de busca de livros utilizando a API do Google Books">
    <meta name="keywords" content="livros, busca, biblioteca, google books">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <title>Book Search | Encontre seus livros favoritos</title>
    
    <style>
        /* ========== RESET CSS ========== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            text-decoration: none;
            font-size: 100%;
        }

        html, body {
            height: 100%;
            width: 100%;
        }

        ol, ul {
            list-style: none;
        }

        /* ========== ESTILO GERAL & VARIÁVEIS ========== */
        :root {
            /* Cores */
            --color-primary: #000000;
            --color-secondary: #ffffff;
            --color-accent: #0066cc;
            --color-accent-hover: #0052a3;
            --color-text: #333333;
            --color-light-gray: #f5f5f5;
            --color-border: #e0e0e0;
            --color-error: #d32f2f;
            --color-success: #388e3c;
            --color-placeholder: #999;
            --color-background: #fafafa;
            
            /* Fontes */
            --font-family-base: "Inter", -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
            
            /* Transições */
            --transition-fast: 0.2s ease;
            --transition-normal: 0.3s ease;
            
            /* Sombras */
            --shadow-light: 0 1px 3px rgba(0, 0, 0, 0.05);
            --shadow-medium: 0 2px 6px rgba(0, 0, 0, 0.08);
            --shadow-heavy: 0 4px 12px rgba(0, 0, 0, 0.1);
            --shadow-focus: 0 0 0 3px rgba(0, 102, 204, 0.1);
        }

        body {
            background-color: var(--color-background);
            font-family: var(--font-family-base);
            color: var(--color-text);
            line-height: 1.6;
            overflow-x: hidden;
        }

        .main {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            max-width: 1200px;
            margin: 0 auto;
            padding: 60px 20px 40px;
        }

        .title {
            color: var(--color-primary);
            font-weight: 700;
            font-size: 2.5rem;
            text-align: center;
            margin-bottom: 40px;
            letter-spacing: -0.5px;
        }

        .subtitle {
            color: var(--color-text);
            font-weight: 400;
            font-size: 1.1rem;
            text-align: center;
            margin-bottom: 40px;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }

        /* ========== FEEDBACK (ERRO/LOADING/SUCESSO) ========== */
        .feedback-message {
            display: none;
            font-weight: 500;
            text-align: center;
            margin-top: 20px;
            font-size: 0.95em;
            padding: 12px 16px;
            border-radius: 6px;
            max-width: 500px;
            margin-left: auto;
            margin-right: auto;
        }

        .error-message {
            color: var(--color-error);
            background-color: rgba(211, 47, 47, 0.05);
            border: 1px solid rgba(211, 47, 47, 0.2);
        }

        .success-message {
            color: var(--color-success);
            background-color: rgba(56, 142, 60, 0.05);
            border: 1px solid rgba(56, 142, 60, 0.2);
        }

        .feedback-message.active {
            display: block;
        }

        .spinner {
            animation: rotate 0.8s linear infinite;
            border: 2px solid var(--color-light-gray);
            border-top-color: var(--color-accent);
            border-radius: 50%;
            display: none;
            height: 24px;
            width: 24px;
            margin: 30px auto;
        }

        .spinner.active {
            display: block;
        }

        @keyframes rotate {
            to {
                transform: rotate(360deg);
            }
        }

        /* ========== SEARCH AREA ========== */
        .search-section {
            display: flex;
            justify-content: center;
            margin-bottom: 50px;
        }

        .search-area {
            background-color: var(--color-secondary);
            border: 1px solid var(--color-border);
            border-radius: 8px;
            box-shadow: var(--shadow-light);
            height: 44px;
            width: 100%;
            max-width: 500px;
            display: flex;
            align-items: center;
            padding: 0 16px;
            transition: all var(--transition-fast);
        }

        .search-area:hover {
            border-color: #999;
            box-shadow: var(--shadow-medium);
        }

        .search-area:focus-within {
            border-color: var(--color-accent);
            box-shadow: var(--shadow-focus);
        }

        .search-area__input {
            font-size: 0.95em;
            flex: 1;
            background: transparent;
            border: none;
            outline: none;
            padding: 0;
            color: var(--color-text);
        }

        .search-area__input::placeholder {
            color: var(--color-placeholder);
        }

        .search-area__btn {
            background-color: transparent;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            padding: 4px;
            transition: all var(--transition-fast);
            border-radius: 4px;
        }

        .search-area__btn:hover {
            opacity: 0.7;
            background-color: rgba(0, 0, 0, 0.05);
        }

        .search-area__btn:focus {
            outline: none;
            box-shadow: 0 0 0 2px rgba(0, 102, 204, 0.3);
        }

        .search-area__btn--clear {
            display: none;
            margin-right: 8px;
            font-size: 0.9em;
        }

        .search-area__btn--clear.active {
            display: flex;
        }

        .search-area__btn--submit {
            margin-left: 8px;
        }

        .search-area__icon {
            font-size: 1.3em;
        }

        .search-area__icon--submit {
            color: var(--color-primary);
        }

        .search-area__icon--clear {
            color: var(--color-placeholder);
            font-size: 1.2em;
        }

        /* ========== RESULTS INFO ========== */
        .results-info {
            text-align: center;
            margin-bottom: 20px;
            color: var(--color-text);
            font-size: 0.9rem;
            display: none;
        }

        .results-info.active {
            display: block;
        }

        /* ========== BOOK CARDS (LIST) ========== */
        .book-list {
            display: none;
            flex-wrap: wrap;
            gap: 20px;
            justify-content: center;
            padding: 0;
            margin: 0;
        }

        .book-list.loaded {
            display: flex;
        }

        .book-card {
            border-radius: 8px;
            border: 1px solid var(--color-border);
            width: 100%;
            max-width: 280px;
            box-shadow: var(--shadow-light);
            background-color: var(--color-secondary);
            transition: all var(--transition-normal);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            position: relative;
        }

        .book-card:hover {
            border-color: #999;
            box-shadow: var(--shadow-heavy);
            transform: translateY(-2px);
        }

        .book-card__image {
            width: 100%;
            height: 180px;
            object-fit: cover;
            background-color: var(--color-light-gray);
            transition: transform var(--transition-normal);
        }

        .book-card:hover .book-card__image {
            transform: scale(1.03);
        }

        .book-card__body {
            padding: 16px;
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .book-card__title {
            font-size: 0.95em;
            line-height: 1.4;
            font-weight: 600;
            color: var(--color-primary);
            margin-bottom: 8px;
            flex-grow: 1;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .book-card__detail {
            color: #666;
            font-size: 0.85em;
            margin-bottom: 4px;
            line-height: 1.4;
        }

        .book-card__detail-label {
            color: var(--color-primary);
            font-weight: 600;
            font-style: normal;
        }

        .book-card__link {
            border: 1px solid var(--color-accent);
            border-radius: 4px;
            color: var(--color-accent);
            font-weight: 500;
            padding: 8px 12px;
            display: inline-block;
            margin-top: 12px;
            font-size: 0.85em;
            text-align: center;
            transition: all var(--transition-fast);
            text-decoration: none;
        }

        .book-card__link:hover {
            background-color: var(--color-accent);
            color: var(--color-secondary);
            text-decoration: none;
        }

        .book-card__link:focus {
            outline: none;
            box-shadow: 0 0 0 3px rgba(0, 102, 204, 0.2);
        }

        /* ========== EMPTY STATE ========== */
        .empty-state {
            display: none;
            text-align: center;
            padding: 40px 20px;
            color: var(--color-placeholder);
        }

        .empty-state.active {
            display: block;
        }

        .empty-state__icon {
            font-size: 3rem;
            margin-bottom: 16px;
            color: var(--color-border);
        }

        .empty-state__title {
            font-size: 1.2rem;
            margin-bottom: 8px;
            color: var(--color-text);
        }

        .empty-state__description {
            font-size: 0.9rem;
            max-width: 400px;
            margin: 0 auto;
        }

        /* ========== RESPONSIVO ========== */
        @media only screen and (max-width: 768px) {
            .title {
                font-size: 2rem;
                margin-bottom: 30px;
            }

            .subtitle {
                font-size: 1rem;
                margin-bottom: 30px;
            }

            .search-area {
                max-width: 90%;
            }

            .book-card {
                max-width: 100%;
            }

            .book-list {
                gap: 16px;
                padding: 0 16px;
            }
            
            .main {
                padding: 60px 16px 40px;
            }
        }

        @media only screen and (max-width: 480px) {
            .title {
                font-size: 1.75rem;
                margin-bottom: 25px;
            }

            .subtitle {
                font-size: 0.9rem;
                margin-bottom: 25px;
            }

            .search-area {
                max-width: 95%;
                height: 40px;
                padding: 0 12px;
            }

            .search-area__input {
                font-size: 0.9em;
            }

            .search-area__icon {
                font-size: 1.1em;
            }

            .book-card {
                max-width: 100%;
            }

            .book-list {
                gap: 12px;
                padding: 0 12px;
            }

            .book-card__image {
                height: 150px;
            }

            .book-card__body {
                padding: 12px;
            }
        }
    </style>
</head>
<body>
    <main id="main" class="main">
        <header>
            <h1 class="title">Book Search</h1>
            <p class="subtitle">Encontre informações sobre seus livros favoritos usando a API do Google Books</p>
        </header>

        <section id="search-section" class="search-section" aria-label="Pesquisa de Livros">
            <div class="search-area" role="search">
                <input id="search-input" type="text" placeholder="Digite o título, autor ou assunto..." class="search-area__input" aria-label="Digite o nome do livro para pesquisa">
                
                <button id="remove-btn" class="search-area__btn search-area__btn--clear" type="button" aria-label="Limpar campo de pesquisa">
                    <i class="material-icons search-area__icon search-area__icon--clear">close</i>
                </button>
                
                <button id="search-btn" class="search-area__btn search-area__btn--submit" type="submit" aria-label="Buscar livro">
                    <i class="material-icons search-area__icon search-area__icon--submit">search</i>
                </button>
            </div>
        </section>

        <section class="results-section">
            <div id="loading" class="spinner" role="status" aria-label="Carregando"></div>
            <p id="error" class="feedback-message error-message" role="alert" aria-live="assertive" tabindex="0"></p>
            <p id="success" class="feedback-message success-message" role="status" aria-live="polite"></p>
            <p id="results-info" class="results-info" aria-live="polite"></p>
            
            <div id="empty-state" class="empty-state" aria-live="polite">
                <i class="material-icons empty-state__icon">menu_book</i>
                <h2 class="empty-state__title">Nenhum livro encontrado</h2>
                <p class="empty-state__description">Tente pesquisar por um título, autor ou assunto diferente.</p>
            </div>
            
            <ul id="container-list" class="book-list" aria-label="Lista de livros encontrados">
            </ul>
        </section>
    </main>

    <script>
        // ========== COMPONENTES DOM ==========
        const input = document.getElementById("search-input");
        const loadingIcon = document.getElementById("loading");
        const containerError = document.getElementById("error");
        const containerSuccess = document.getElementById("success");
        const containerList = document.getElementById("container-list");
        const removeBtn = document.getElementById("remove-btn");
        const searchBtn = document.getElementById("search-btn");
        const resultsInfo = document.getElementById("results-info");
        const emptyState = document.getElementById("empty-state");

        // Constantes
        const NO_COVER_IMAGE = 'https://via.placeholder.com/280x180?text=No+Cover';
        const QTY_BOOK = 12;
        const API_URL = 'https://books.googleapis.com/books/v1/volumes';

        // ========== FUNÇÕES DE ESTADO (Loading, Erro, Sucesso) ==========

        /**
         * Exibe ou oculta o ícone de carregamento.
         * @param {boolean} isLoading - Se deve mostrar (true) ou ocultar (false) o loading.
         */
        function setLoading(isLoading) {
            loadingIcon.classList.toggle("active", isLoading);
        }

        /**
         * Exibe uma mensagem de erro na página.
         * @param {string} errorMessage - A mensagem de erro a ser exibida.
         */
        function displayError(errorMessage) {
            containerError.textContent = errorMessage;
            containerError.classList.add("active");
            containerSuccess.classList.remove("active");
            containerError.focus(); // Foca no erro para acessibilidade
        }

        /**
         * Exibe uma mensagem de sucesso na página.
         * @param {string} successMessage - A mensagem de sucesso a ser exibida.
         */
        function displaySuccess(successMessage) {
            containerSuccess.textContent = successMessage;
            containerSuccess.classList.add("active");
            containerError.classList.remove("active");
        }

        /**
         * Limpa os resultados anteriores e mensagens de feedback.
         */
        function clearPage() {
            containerList.innerHTML = "";
            containerList.classList.remove("loaded");
            containerError.textContent = "";
            containerError.classList.remove("active");
            containerSuccess.textContent = "";
            containerSuccess.classList.remove("active");
            resultsInfo.textContent = "";
            resultsInfo.classList.remove("active");
            emptyState.classList.remove("active");
        }

        /**
         * Exibe informações sobre os resultados da busca.
         * @param {number} totalResults - Número total de resultados encontrados.
         * @param {string} searchTerm - Termo de busca utilizado.
         */
        function displayResultsInfo(totalResults, searchTerm) {
            if (totalResults > 0) {
                resultsInfo.textContent = `Encontrados ${totalResults} resultados para "${searchTerm}"`;
                resultsInfo.classList.add("active");
                emptyState.classList.remove("active");
            } else {
                resultsInfo.classList.remove("active");
                emptyState.classList.add("active");
            }
        }

        // ========== MANIPULAÇÃO DO BOTÃO 'REMOVE' ==========

        /**
         * Controla a visibilidade do botão de limpar (remove).
         */
        function toggleRemoveButton() {
            removeBtn.classList.toggle("active", input.value.trim() !== "");
        }

        input.addEventListener('input', toggleRemoveButton);
        removeBtn.addEventListener('click', () => {
            input.value = "";
            input.focus();
            toggleRemoveButton();
            clearPage();
        });

        // ========== CRIAÇÃO DE ELEMENTOS (CARD) ==========

        /**
         * Sanitiza uma string para evitar XSS.
         * @param {string} str - String a ser sanitizada.
         * @returns {string} String sanitizada.
         */
        function sanitizeHTML(str) {
            const temp = document.createElement('div');
            temp.textContent = str;
            return temp.innerHTML;
        }

        /**
         * Formata a data para exibição.
         * @param {string} dateString - Data no formato string.
         * @returns {string} Data formatada.
         */
        function formatDate(dateString) {
            if (!dateString) return "Data Desconhecida";
            
            try {
                const date = new Date(dateString);
                return date.toLocaleDateString('pt-BR');
            } catch (error) {
                return dateString;
            }
        }

        /**
         * Cria o HTML para o card de um livro.
         * @param {object} book - Objeto com as informações do livro.
         * @returns {HTMLLIElement} O elemento <li> do card.
         */
        function createBookCard(book) {
            const cardBook = document.createElement("li");
            cardBook.className = "book-card";
            
            // Sanitiza e prepara os dados
            const title = sanitizeHTML(book.title || "Título Desconhecido");
            const author = sanitizeHTML(book.author || "Autor Desconhecido");
            const publisher = sanitizeHTML(book.publisher || "Editora Desconhecida");
            const publishedDate = formatDate(book.publishedDate);
            const pagesNumber = book.pagesNumber ? `${book.pagesNumber} páginas` : "Número de páginas desconhecido";
            const imageLink = book.imageLink || NO_COVER_IMAGE;
            const previewLink = book.previewLink && book.previewLink !== 'undefined' ? book.previewLink : "#";

            // Estrutura do Card
            cardBook.innerHTML = `
                <img src="${imageLink}" class="book-card__image" alt="Capa do livro: ${title}" loading="lazy">
                <div class="book-card__body" tabindex="0">
                    <h3 class="book-card__title" aria-label="Título do livro: ${title}">${title}</h3>
                    <p class="book-card__detail"><em class="book-card__detail-label">Autor:</em> ${author}</p>
                    <p class="book-card__detail"><em class="book-card__detail-label">Editora:</em> ${publisher}</p>
                    <p class="book-card__detail"><em class="book-card__detail-label">Publicação:</em> ${publishedDate}</p>
                    <p class="book-card__detail"><em class="book-card__detail-label">Páginas:</em> ${pagesNumber}</p>
                    <a href="${previewLink}" target="_blank" rel="noopener noreferrer" class="book-card__link" aria-label="Link de visualização no Google Books para o livro ${title}">Visualizar</a>
                </div>
            `;
            return cardBook;
        }

        /**
         * Processa os dados da API e insere os cards de livros na lista.
         * @param {Array<object>} booksAllInfos - Array de objetos de informações da API.
         * @param {string} searchTerm - Termo de busca utilizado.
         */
        function insertBooksOnPage(booksAllInfos, searchTerm) {
            const validBooks = [];
            
            booksAllInfos.forEach(listOfBookInfo => {
                const bookInfo = listOfBookInfo.volumeInfo;
                
                // Verifica se o livro tem informações básicas
                if (!bookInfo || !bookInfo.title) return;
                
                // Mapeia e sanitiza as informações da API
                const bookObject = {
                    title: bookInfo.title,
                    author: bookInfo.authors ? bookInfo.authors.join(", ") : null,
                    publisher: bookInfo.publisher,
                    publishedDate: bookInfo.publishedDate,
                    pagesNumber: bookInfo.pageCount,
                    imageLink: bookInfo.imageLinks ? bookInfo.imageLinks.thumbnail : null,
                    previewLink: bookInfo.previewLink
                };

                validBooks.push(bookObject);
            });
            
            // Exibe informações sobre os resultados
            displayResultsInfo(validBooks.length, searchTerm);
            
            // Se não há livros válidos, não prossegue
            if (validBooks.length === 0) return;
            
            // Cria e insere os cards
            validBooks.forEach(book => {
                const cardElement = createBookCard(book);
                containerList.appendChild(cardElement);
            });
            
            containerList.classList.add("loaded");
        }

        // ========== FUNÇÃO DE BUSCA (API) ==========

        /**
         * Valida o termo de busca.
         * @param {string} searchTerm - Termo de busca a ser validado.
         * @returns {Object} Objeto com isValid (boolean) e message (string).
         */
        function validateSearchTerm(searchTerm) {
            if (!searchTerm || searchTerm.trim() === "") {
                return {
                    isValid: false,
                    message: "Por favor, digite o título de um livro para pesquisar."
                };
            }
            
            if (searchTerm.length < 2) {
                return {
                    isValid: false,
                    message: "O termo de busca deve ter pelo menos 2 caracteres."
                };
            }
            
            if (searchTerm.length > 100) {
                return {
                    isValid: false,
                    message: "O termo de busca é muito longo. Tente uma pesquisa mais específica."
                };
            }
            
            return { isValid: true };
        }

        /**
         * Formata o termo de busca para a URL da API.
         * @param {string} searchTerm - Termo de busca.
         * @returns {string} Termo formatado para URL.
         */
        function formatSearchTerm(searchTerm) {
            return encodeURIComponent(searchTerm.trim());
        }

        /**
         * Realiza a chamada à API do Google Books.
         * @param {string} bookNameForApi - Termo de busca formatado para a URL.
         * @param {string} originalSearchTerm - Termo de busca original (para exibição).
         */
        async function search(bookNameForApi, originalSearchTerm) {
            const url = `${API_URL}?q=${bookNameForApi}&maxResults=${QTY_BOOK}&fields=items/volumeInfo(authors,imageLinks,pageCount,publisher,publishedDate,previewLink,title)`;
            
            setLoading(true);

            try {
                const response = await fetch(url);
                
                if (!response.ok) {
                    throw new Error(`Erro de rede: ${response.status}. Tente novamente mais tarde.`);
                }

                const json = await response.json();
                
                if (!json.items || json.items.length === 0) {
                    throw new Error("Nenhum livro encontrado. Tente outro termo de pesquisa.");
                }
                
                insertBooksOnPage(json.items, originalSearchTerm);
                displaySuccess(`Busca realizada com sucesso!`);

            } catch (error) {
                console.error("Search Error:", error);
                displayError(error.message || "Ocorreu um erro ao buscar os livros.");
                
            } finally {
                setLoading(false);
            }
        }

        // ========== LISTENERS PRINCIPAIS ==========

        /**
         * Função principal que inicia a busca.
         */
        function handleSearch() {
            clearPage();
            const bookName = input.value.trim();

            // Valida o termo de busca
            const validation = validateSearchTerm(bookName);
            if (!validation.isValid) {
                displayError(validation.message);
                input.focus();
                toggleRemoveButton();
                return;
            }

            const bookNameForApi = formatSearchTerm(bookName);
            search(bookNameForApi, bookName);
        }

        // Escuta clique no botão de busca
        searchBtn.addEventListener('click', handleSearch);

        // Escuta a tecla Enter no campo de busca
        input.addEventListener('keypress', (e) => {
            if (e.key === "Enter") {
                e.preventDefault();
                handleSearch();
            }
        });

        // Foco inicial no campo de busca
        window.addEventListener('load', () => {
            input.focus();
        });
    </script>
</body>
</html>
